# Representing Attitude: Euler Angles, Unit Quaternions, and RotationVectors

# Abst

3次元空間における剛体の姿勢を表現するための3つの主要な数学的構成要素を紹介します。これらは、(1)回転行列、(2)オイラー角の3重構造、(3)単位四元数です。これに4つ目の回転ベクトルを加えると、オイラー角と四元数の多くの利点がありますが、オイラー角の特異性や四元数の制約はありません。この他にも、ケイリークラインパラメータや軸角表現など、いくつかの補助的な表現があり、これらの表現と3つの主要な表現との関係についても説明します。ここでの説明は、このテーマ全体についての完全で統一された参考文献を求める人のためのものであり、いくつかの結果の詳細な導出は示されていない。

# 1. Intro

本書は，3次元空間における物体の姿勢をパラメータ化することをテーマとした，統一的なリファレンスとして作成されたものである。これは、既存のオンライン文献のギャップを埋めるために書かれたものです。特に、オイラー角と四元数のテーマについては、多くのウェブページやテクニカルレポートがありますが、一貫した詳細で統一された取り扱いで、すべてのトピックをカバーする単一のリファレンスを見つけることができませんでした。 この問題は、現在使用されている数多くの慣習や、著者が自分の選択を明示せずに特定の慣習を仮定したり、代替案についてコメントしない傾向があることで、さらに悪化しています。 さらに、既存のオンライン文献では、3つのオイラー角の様々な可能な選択肢の分野で特に大きなギャップがあります。

剛体の姿勢を表す最も一般的な方法は、3つのオイラー角の組み合わせです。オイラー角は、わかりやすく、使いやすいので人気があります。オイラー角の中には、飛行機のロール、ピッチ、ヨーのように、一般に広く使われている名称がある。オイラー角の主な欠点は次のとおりである。
(1)オイラー角の重要な関数には特異点があること
(2)姿勢の時間的変化を積分する際に単位四元数よりも精度が低いこと
です。

このようなオイラー角表現の欠点から、剛体の姿勢のパラメータ化には単位四元数が用いられている。単位四元数の関連関数には特異点がなく、この表現は物体の角速度を時間的に積分するのに適している。単位四元数の主な欠点は以下の通りです。
(1)四元数が直感的な物理的意味を持たないこと
(2)四元数が純粋な回転であるためにはユニティノルムを持たなければならないこと
姿勢パラメータを最適化に含める場合、二次形式であるユニティノルム制約は特に問題となりますが、ほとんどの標準的な最適化アルゴリズムはこのような制約を符号化できないからです。

オイラー角や単位四元数に代わるものとして、回転ベクトルがあります。回転ベクトルは、オイラー角の特異性と単位四元数の二次的制約の両方を欠いています。これは新しいパラメータ化ではありませんが、このテーマに関する既存の文献には詳細が不足していることがわかりました。回転ベクトルは、慎重に設計してもオイラー角の特異点を回避できない場合に、姿勢パラメータを最適化しようとする場合に特に有効です。それ以外の状況では最良の選択ではないかもしれません。

## 1.1. コンテンツの概要

1.3節では、本レポートで使用されている座標系を定義しています。2章では、回転行列の概念を紹介し、その重要な特性を説明します。第3章では、剛体運動学を紹介します。5章では、オイラー角について、最も一般的に使用されている3つの慣用法の詳細を含め、その多様性について説明しています。第6章では、四元数、特に単位四元数と軸角の表現について説明します。7章では、回転ベクトルを四元数の3次元パラメタライズとして説明します。最後に，8章では12種類のオイラー角のパラメータ化のカタログを示す。 本報告書では，必要に応じて，様々な表現方法の間の変換や，使用方法や命名規則に関する説明を行っている。

## 1.2. Sources

本報告書の数学的結果は、基本的な定義と第一原理から導き出されたものです。結果を確認するために、また、さまざまな規則の使用に関する情報を提供するために、いくつかの資料を使用しました。オイラー角については、[1] および [4] を参照しています。Caley-Kleinパラメータについては，[3] を参照しています．四元数と Euler-Rodrigues パラメータについては、[5] と [2] を、特に後者を引用します。キネマティクスについては、[1] を参照しています。

## 1.3. 座標系

2つの異なる座標系で表現されたデータの関係を考えます。
* ワールド座標系は、慣性空間に固定されています。
* この座標系の原点を $x_w$ とする。体固定座標系は、姿勢を表現したい物体に固く固定されています。この座標系の原点を $x_b$ とする。

体内固定座標で表現された点やベクトルは，世界座標で表現されたものとは素数記号で区別される。 例えば，$x$ が世界座標上の点であるならば，$x′$ は体部固定座標上で表現された同じ点である。言うまでもなく，$x_w$ と $x′_b$ はともにゼロであるが，$x′_w$ と $x_b$は一般的にはゼロではない。ここで，$x′_w$ は体側固定座標で表された世界座標の原点であり，$x_b$ は世界座標で表された体内固定座標の原点である。

このドキュメントで説明されている数学の一部は、世界座標系が回転固定の場合にのみ適用されます。しかし、多くの目的では、角速度がゼロではないにもかかわらず、地球に取り付けられた座標系のようにゆっくりと回転する座標系を有効な世界座標系とみなすことはまったく問題ありません。

# 2. 回転行列

回転行列とは，ベクトルとの掛け算で，その長さを保ったままベクトルを回転させる行列のことである。すべての3×3回転行列の特別な直交群を $SO(3)$ と呼ぶ。したがって、$R \in SO(3)$ の場合は

$$
\det{R} = \pm1  R^{−1} = R^T.
$$

$\det{R}=1$ の回転行列を *proper*と呼び、$\det{R}=-1$ の回転行列を *inproper* と呼ぶ。不適切な回転は *rotoinversions* とも呼ばれ、回転の後に反転操作が行われます。不適切な回転は剛体変換ではないので、ここでは適切な回転に限定して分析する。

回転行列の要素を以下のように参照する。
$$
R = \left[
  \begin{array}{ccc}
    \bm{r}_1 & \bm{r}_2 & \bm{r}_3
  \end{array}
  \right] \\
$$
$$
 = \left[ \begin{array}{ccc}
    r_{11} & r_{12} & r_{13} \\
    r_{21} & r_{22} & r_{23} \\
    r_{31} & r_{32} & r_{33}
   \end{array} \right]
$$

剛体の姿勢を表す回転行列の定義には2つの方法があり、現在はどちらも使用されています体内固定座標からワールド座標に対応する行列を書きたいという人もいれば、ワールド座標から体内固定座標に対応する行列を書きたいという人もいます。

この2つの表記法の変換は，行列の転置を行うのと同じくらい簡単なことですが，2つの表記法の結果を一緒に使う前に，2つの異なる表記法が同じ表記法であることを確認する必要があります。実際，このレポートの動機の1つは，このテーマ全体をカバーする1つの一貫したリファレンスを提供することです。

## 2.1. 座標変換

剛体の姿勢を符号化する回転行列 $R$ を、世界座標で表されたベクトルに前置乗算すると、体内固定座標で表された同じベクトルが得られる行列と定義する。すなわち，$\bm{z} \in \mathbb{R}^3$ を世界座標で表されたベクトルとし，$\bm{z}′ \in \mathbb{R}^3$ を身体固定座標で表された同じベクトルとすると，次のような関係が成り立つ。

$$
\bm{z}' = R \bm{z}
$$
$$
\bm{z} = R^T \bm{z}'
$$

これらの表現は、空間内の位置を欠く相対的な量であるベクトルに適用される。 ある点をある座標系から他の座標系に変換するには、回転行列を適用する前に、対象となる座標系の原点へのオフセットを差し引かなければならない。したがって、$\bm{x} \in \mathbb{R}^3$ が世界座標上の点であり、$\bm{x}′ \in \mathbb{R}^3$ が体内固定座標で表された同じ点である場合、次のように書くことができます。

$$
\bm{x}' = R(\bm{x}-\bm{x}_b) = R\bm{x} + \bm{x}'_w
$$
$$
\bm{x} = R^T(\bm{x}' - \bm{x}_w') = R^T\bm{x}' + \bm{x}_b
$$

式6に $\bm{x} = 0$ を、式7に $\bm{x}' = 0$ を代入すると、次のようになります。

$$
\bm{x}_w' = -R\bm{x}_b
$$
$$
\bm{x}_b = -R^T\bm{x}_w'
$$

## 2.2. 変換行列

コンピュータグラフィックスの世界では、式（6）と式（7）を行列-ベクトル積として記述することがよくあります。

$$
\left[
  \begin{array}{c}
    \bm{x}' \\ 1
  \end{array}
\right] =
\left[
  \begin{array}{cc}
    R & \bm{x}_w' \\
    \bm{0}^T & 1
  \end{array}
\right]
\left[
  \begin{array}{c}
    \bm{x} \\
    1
  \end{array}
\right]
=\left[
  \begin{array}{cc}
    R & -R \bm{x}_b \\
    \bm{0}^T & 1
  \end{array}
\right]
\left[
  \begin{array}{c}
    \bm{x} \\
    1
  \end{array}
\right]
$$

$$
\left[
  \begin{array}{c}
    \bm{x} \\ 1
  \end{array}
\right] =
\left[
  \begin{array}{cc}
    R^T & \bm{x}_b \\
    \bm{0}^T & 1
  \end{array}
\right]
\left[
  \begin{array}{c}
    \bm{x}' \\
    1
  \end{array}
\right]
=\left[
  \begin{array}{cc}
    R^T & -R^T \bm{x}_w' \\
    \bm{0}^T & 1
  \end{array}
\right]
\left[
  \begin{array}{c}
    \bm{x'} \\
    1
  \end{array}
\right]
$$

この方式は、3Dアクセラレーション対応のハードウェアメーカーが採用していることもあり、かなり普及しています。


## 2.3. 剛体の姿勢

剛体のポーズとは、その剛体の位置と姿勢のことである。このレポートの大部分は姿勢のパラメータ化を扱っている。位置は、世界座標で表現された体内固定座標の原点の位置である $x_b$によって最も自然に符号化される。 しかし、体の固定座標で表現された世界座標の原点の位置である $x_w'$を格納することも同様に有効である。 この2つは、式8と式9により、剛体の姿勢を介して互いに関連している。

## 2.4. 座標軸の回転

座標回転とは、一つの座標軸を中心とした回転のことである。$X$軸、$Y$軸、$Z$軸を1、2、3と列挙すると、$i \in {1,2,3}$ に対する座標回転 $Ri:R \rightarrow SO(3)$ は、次のようになる。

$$
R_1(\alpha) =
\left[
  \begin{array}{ccc}
    1 & 0 & 0 \\
    0 & \cos(\alpha) & \sin(\alpha) \\
    0 & -\sin(\alpha) & \cos(\alpha)
  \end{array}
\right]
$$
$$
R_2(\alpha) =
\left[
  \begin{array}{ccc}
    \cos(\alpha) & 0 & -\sin(\alpha) \\
    0 & 1 & 0 \\
    \sin(\alpha) & 0 & \cos(\alpha)
  \end{array}
\right]
$$
$$
R_3(\alpha) =
\left[
  \begin{array}{ccc}
    \cos(\alpha) & \sin(\alpha) & 0 \\
    -\sin(\alpha) & \cos(\alpha) & 0 \\
    0 & 0 & 1
  \end{array}
\right]
$$

この形式の回転の例を図1に示します。これは、z軸を中心に角度 $\alpha$ だけ回転させたものです。

![fig1]()
図1：z軸を中心に角度αだけ回転させた座標の例。