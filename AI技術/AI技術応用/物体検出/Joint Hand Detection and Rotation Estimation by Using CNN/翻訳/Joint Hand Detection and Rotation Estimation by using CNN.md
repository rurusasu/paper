# Joint Hand Detection and Rotation Estimation by Using CNN

# 備考

## 著者
Xiaoming Deng, Ye Yuan, Yinda Zhang, Ping Tan, Liang Chang, Shuo Yang, Hongan Wang

## 掲載
Proc. IEEE International Conference on Computer Vision Workshop (ICCVW), pp. 32-40, 2015.

# Abstract
手検出は、手に関連する多くのタスクに不可欠です。手のポーズの解析、ジェスチャーの理解。これは、ロボット工学と人間とコンピューターの相互作用に非常に役立ちます。ただし、制御されていない環境での手検出は、手首の関節の柔軟性と雑然とした背景のために困難です。手を検出し、同時に監視下で面内回転を調整する、深層学習ベースのアプローチを提案します。リコールを保証するために、選択的検索を大幅に上回るコンテキスト認識提案生成アルゴリズムを提案します。次に、オブジェクトの回転を明示的に処理する畳み込みニューラルネットワーク（CNN）を設計し、オブジェクトの検出と回転の推定タスクを共同で解決します。実験により、オックスフォードデータベースやエゴハンズデータベースなどの広く使用されているベンチマークで、最新の検出モデルよりも優れた結果が得られることが示されています。さらに、回転の推定と分類が相互に利益をもたらすことを示します。

# 1. Introduction
手の検出は基本的であり、人間とコンピュータの相互作用やロボット工学において非常に有用です。コンピュータとロボットが人間の意図を理解するのに役立ち[1]、さまざまな手掛かりを提供します。高レベルのタスクのための力、ポーズ、意図。画像内で手の位置を特定するだけでなく、手の面内回転を決定することも重要です。これは、通常、手のポーズ推定[2]やジェスチャー認識[3]などの他のタスクの初期化と見なされるためです。一般的なオブジェクト検出のベンチマークは過去10年間で更新されていますが、単一の画像からの手の検出は、手首の回転や指の関節動作によって手の形状が大きく変化するため、依然として困難です[4] [5]。

![Pipeline of our system](https://raw.githubusercontent.com/rurusasu/paper/master/AI%E6%8A%80%E8%A1%93/AI%E6%8A%80%E8%A1%93%E5%BF%9C%E7%94%A8/%E7%94%BB%E5%83%8F/Joint%20Hand%20Detection%20and%20Rotation%20Estimation%20by%20Using%20CNN/Pipeline%20of%20our%20system.png)\
図1. 私たちのシステムのパイプライン：関節の検出と回転の推定。<br>まず、入力画像から領域提案を生成し、それらをニューラルネットワークにフィードします。面内回転は回転ネットワークによって推定され、入力提案に適用されます。調整されたデータは、検出ネットワークに送られます。デローテーションレイヤーのおかげで、2つのタスクがエンドツーエンドで共同で最適化されます。

この論文では、面内回転推定と共同で手検出問題を解決することを提案します。図1は、私たちのシステムの一般的なパイプラインを示しています。 RCNN [6]フレームワークに触発されて、まず手を含む可能性が高い長方形の領域をいくつか抽出します（図1（a））。画像の乱雑さと手の関節形状により、選択的検索[7]やオブジェクトネス[8]などの最先端の領域提案手法を大幅に上回る、差別的な提案生成アルゴリズムを提案します。リコールの期間。次に、回転ネットワークは、入力手がある場合、直立方向に位置合わせする面内回転を推定します（図1（b））。入力データは、この推定された回転に従って回転され、検出ネットワークに送られ、バイナリ分類が実行されます（図1（c））。

私たちのモデルは、複数のタスクと同時にトレーニングされ、多くのビジョンタスクで非常に成功することが実証されています。私たちの場合、手の検出と面内回転は密接に関連しており、互いに利益をもたらす可能性があります。異なる回転でトレーニングデータを直立位置にキャリブレーションすると、回転不変の特徴が得られ、検出/分類モデルの負担が軽減されます。見返りとして、検出モデルは回転推定が妥当かどうかを検証できます。ただし、たたみ込みニューラルネットワークの性質により、回転不変性は並進不変性よりも実現が難しく、エンドツーエンドの最適化が妨げられます。その結果、以前の作品[9]は通常、変換の推定と検出を個別にまたは反復的に処理するため、大域的な最適化を達成できない場合があります。

フィーチャーマップを特定の角度まで明示的に回転させるデローテーションレイヤーを設計します。これにより、2つのタスクのネットワークを同時に最適化できます（ネットワーク構造につ​​いては、図2を参照）。最近、空間変換ネットワーク（STCNN）[10]も、CNNを使用してフィーチャマップを積極的に空間変換する微分可能モジュールを提示しました。ただし、それらの変換は教師なしで学習されるため、直接解釈できない任意の回転になる可能性があります（ST-CNNが理想的な手検出モデルではない可能性があるという説明は、付録に示されています）。また、変換スペースは通常巨大であり、収束するためにより多くのデータと時間が必要になります。比較すると、私たちの回転推定ネットワークは、出力を関連するタスクに直接使用できるように、直立配置を目的としています。手のポーズ推定。また、収束する可能性が高い、訓練された監視ありです。フィーチャーマップを特定の角度まで明示的に回転させるデローテーションレイヤーを設計します。これにより、2つのタスクのネットワークを同時に最適化できます（ネットワーク構造につ​​いては、図2を参照）。最近、空間変換ネットワーク（STCNN）[10]も、CNNを使用してフィーチャマップを積極的に空間変換する微分可能モジュールを提示しました。ただし、それらの変換は教師なしで学習されるため、直接解釈できない任意の回転になる可能性があります（ST-CNNが理想的な手検出モデルではない可能性があるという説明は、付録に示されています）。また、変換スペースは通常巨大であり、収束するためにより多くのデータと時間が必要になります。比較すると、私たちの回転推定ネットワークは、出力を関連するタスクに直接使用できるように、直立配置を目的としています。手のポーズ推定。また、収束する可能性が高い、教師付きトレーニングも受けています。

この論文の貢献は主に4つの側面にあります。まず、私たちの知識により、面内の手の回転を共同で推定して検出を実行する最初のフレームワークを提案します。実験は、広く使用されているベンチマークで、最先端の技術よりも大幅に優れたパフォーマンスを達成することを示しています。次に、逆回転レイヤーを設計します。これにより、2つのタスクを同時に使用してエンドツーエンドの最適化が可能になります。回転推定ネットワークは、より効率的に収束する強力な監視でトレーニングされます。第三に、大幅に改善された再現率と最新の選択的検索[7]およびオブジェクト性[8]を上回る平均平均ベストオーバーラップスコア（MABO）を備えた手形状提案生成アルゴリズムを提案します。最後に重要なことですが、私たちのモデルは以前の作業よりもはるかに効率的です。回転推定ネットワークのおかげで、すべての可能な角度をブルートフォース検索する必要がなく、検出時間を1 = 7に短縮できます。

# 2. RELATED WORK
単一の画像からの最近の手の検出方法は、4つのカテゴリに分類できます。

**皮膚検出法**：これらの方法は、ガウス混合モデル[11]を使用するか、顔検出からの肌色の事前知識を使用して肌モデルを構築します[12]。ただし、これらの方法は、複雑な照明が肌の色に大きな変動をもたらし、肌の色のモデリングの問題を困難にすることが多いため、一般的な条件で手の検出に適用できないことがよくあります。

**テンプレートベースの検出方法**：これらの方法は通常、手のテンプレートまたは変形可能なパーツモデルの混合を学習します。これらは、ViolaおよびJonesカスケード検出器[13]、HOG-SVMパイプライン[13]、変形可能部品モデル（DPM）[4]の混合などのHarr機能によって実装できます。これらのメソッドの制限は、弱い機能（通常はHOGまたはHarr機能）の使用です。人間の手の構造を人間の構造の一部として検出する方法もあり、人間の絵の構造を手の位置の空間コンテキストとして使用します[14]。しかしながら、これらの方法は人間のほとんどの部分が見えることを必要とし、身体部分の閉塞は手の検出を困難にします[15]。

**ピクセルごとのラベリング検出方法**：ピクセルラベリングアプローチ[5]は、自我中心のビデオでの手の検出に非常に成功していることを示しています。 [16]では、ピクセルラベリングアプローチは、構造化画像ラベリング問題にさらに拡張されています。ただし、これらの方法では、画像全体に対して時間のかかるピクセル単位のスキャンが必要です。

**姿勢推定による検出方法**：これらの方法は2つのタイプに分類できます。1）最初にオブジェクトのポーズを推定し、次にオブジェクトのポーズでデローテーションされた画像のオブジェクトラベルを予測します。 Rowley、Baluja、およびKanade [9]は、精巧な回転不変ニューラルネットワークベースの顔検出を提案しました。システムは複数のネットワークを採用しています。1つ目は回転ネットワークで、各入力ウィンドウを処理して向きを決定し、この情報を使用して1つ以上の検出器ネットワーク用のウィンドウを準備します。 2）ポーズの推定と検出を同時に行います。彼、Sigal、Sclaroff [17]は、オブジェクトの検出と姿勢推定を共同で実行するための構造化された定式化を提案しました。フィドラー他al。[18]は、変形可能な3D直方体モデルを使用した3Dオブジェクト検出と視点推定を提案しました。知る限りでは、畳み込みニューラルネットワークを使用して2D画像のオブジェクト検出と回転推定の問題を共同でモデル化することにあまり注意が払われていません。

# 3. APPROACH
![Overview of our model](https://raw.githubusercontent.com/rurusasu/paper/master/AI%E6%8A%80%E8%A1%93/AI%E6%8A%80%E8%A1%93%E5%BF%9C%E7%94%A8/%E7%94%BB%E5%83%8F/Joint%20Hand%20Detection%20and%20Rotation%20Estimation%20by%20Using%20CNN/Overview%20of%20our%20model.png)\
図2. モデルの概要。<br>ネットワークは次の4つの部分で構成されています。1）回転推定と検出タスクの両方に役立つ学習機能の共有ネットワーク。 2）地域提案のローテーションを推定するローテーションネットワーク。 ３）入力された特徴マップを正準姿勢に回転させるための逆回転層。 4）

単一の画像を使用した共同の手検出と回転推定のためのエンドツーエンドの最適化されたディープラーニングフレームワークを提示します。全体的なパイプラインを図2に示します。最初に、手を含む可能性が高い領域の提案を抽出します。手の形状と色の強いローカル特性を特に活用するために、単純なセグメンテーションベースのアルゴリズムではなく、Alexnet [19]の機能を使用して、領域提案のために多成分SVMをトレーニングします。提案は、回転推定とその後の検出の両方に使用される正確な共有機能への畳み込み層に供給されます。回転ネットワークは、分類タスクを実行して、入力画像内に手を上方向に揃えることができる平面内回転を推定します。次に、共有ネットワークは回転ネットワークの結果に従って明示的に回転され、信頼スコアを得るために検出ネットワークを通過します。機能は適切に調整されているはずなので、検出ネットワークは調整を処理する必要がないため、より確実に実行されます。回転変換は逆回転レイヤーによって行われ、逆伝播が可能になり、エンドツーエンドのトレーニングが可能になります。 ST-CNN [10]とは異なり、回転ネットワークと検出ネットワークの両方が監視下でトレーニングされるため、回転ネットワークの出力は、目的のデータ配置に対して保証されます。

## A. Proposal Generation
選択的検索[7]、オブジェクト性[8]、およびカテゴリ独立オブジェクト提案[20]を含む、さまざまなカテゴリ非依存領域提案が提案されています。ただし、背景が乱雑で手の形状が明確であるため、以前の領域の提案（特にセグメンテーションベース）では、管理可能な提案の数を維持しながらリコールを保証できません（実験セクションの表1は、選択的検索と客観性の両方が手で検出するのは良くありません。

手領域提案を生成するために、差別的なアプローチを採用しています。変形可能パーツモデル（DPM）[21]に着想を得て、画像パッチのアスペクト比に基づいてトレーニングデータを8つのサブグループにクラスター化し、各グループのAlexnet [19]から抽出されたプールされたconv5レイヤー機能を使用して1つの線形SVMをトレーニングします。ポジティブデータの100％がユニオン（IOU）上の少なくとも0.5の交差でカバーされるように、検証セットのしきい値を学習します。図4は、この方法により、画像あたりの提案の数を比較可能に保ちながら、大幅に高い再現率を保証することを示しています。

## B. Rotation Aware Network
このセクションでは、回転を認識するニューラルネットワークを導入して、領域の提案に手を含めるかどうかを決定します。詳細なネットワーク構造は補足資料にあります。

1) **ネットワーク構造**：ネットワークは、3つの畳み込み+ relu +プーリングから始まり、入力提案パッチから機能を抽出します。入力フィーチャマップの解像度は、ストライドのため13 _ 13ですが、空間情報は維持されます。この機能に基づいて構築された回転ネットワークは、2つの畳み込みレイヤーとそれに続く完全に接続された3つのレイヤーで構成され、回転する角度を推定して、提案に手がある場合、上向きに揃えることができます。回転推定問題を回帰問題に定式化します。回転した手が与えられると、回転ネットワークはリグレッサとして機能し、2次元の回転推定ベクトルl =（cos _; sin _）を出力します。推定されたlは、デローテーションレイヤーに送信され、トレーニングパッチの方向を修正します。その後、デローテーションレイヤーは、回転ネットワークから推定された平面内角度に従って、共有ネットワークからフィーチャーを回転させます。次に、回転されたフィーチャが2つの畳み込み層と3つの完全に接続された層に供給されて、バイナリ分類が実行され、提案に手を含めるかどうかが通知されます。デローテーションレイヤーは区別可能なため、ネットワーク全体をエンドツーエンドで最適化でき、回転推定と手の検出という2つのタスクを共同で最適化できます。

![Illustration of applying derotation transformation](https://raw.githubusercontent.com/rurusasu/paper/master/AI%E6%8A%80%E8%A1%93/AI%E6%8A%80%E8%A1%93%E5%BF%9C%E7%94%A8/%E7%94%BB%E5%83%8F/Joint%20Hand%20Detection%20and%20Rotation%20Estimation%20by%20Using%20CNN/Illustration%20of%20applying%20derotation%20transformation.png)\
図3. 入力フィーチャマップに逆回転変換を適用する図。<br>デローテーションレイヤーは、$\bm{R_{\alpha}}$によって入力画像を標準的な手のポーズにワープすることを目的としています。この作品では、この図の右側に示すように、標準的な手のポーズは直立した手のポーズです。

2) **デローテーションレイヤー**：デローテーションレイヤーは、単一の順方向パス中に回転変換をフィーチャマップに適用するレイヤーです。このシナリオでは、デローテーションレイヤーの入力は、元の画像から計算された特徴マップと、回転ネットワークまたはグラウンドトゥルースのいずれかから予測された面内回転角度であり、このレイヤーの出力は、指定された回転の下でのデローテーションされた特徴マップです角度、おそらく正準直立ポーズの下（図3を参照）。

$$ 
    \left[
        \begin{array}{r}
            x' \\
            y'
        \end{array}
    \right] = 
    \left[
            \begin{array}{rr}
                \cos\alpha & -\sin\alpha \\
                \sin\alpha & \cos\alpha
            \end{array}
    \right]
    \left[
        \begin{array}{r}
            x \\
            y
        \end{array}
    \right]
$$



ここで、$[x'、y']$は、正規の直立ポーズでの出力フィーチャマップの通常グリッドのターゲット座標、$[x、y]$は、入力フィーチャマップの通常グリッドのソース座標です。

実装では、逆マッピングを使用して出力フィーチャマップを取得します。言い換えれば、各ピクセル毎の入力フィーチャマップ内の位置$[x,y]$に対応する出力$[x',y']$。 $[x,y]$は通常、通常のグリッド上に配置されていません。4つの最も近い隣接位置からの値を平均することにより、特徴を計算します。[x; y]をゼロ埋めする、これは通常のグリッドの外側にあります。別の選択肢は、ボックスの外側に特徴を埋め込むことですが、効率の問題のため、ここでは実装されていません。

逆伝播は、逆回転レイヤーの前と後のフィーチャマップ間の座標間のマッピングの記録で実行できます。 $[x',y']$の値の更新は、その値の取得元の座標に逆伝播されます。これは、[22] [23]の一部のプーリングレイヤーおよびROIレイヤーと同様の方法で行われます。

## C. Loss Layer
